<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Nexus System — Demo</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font + Glow CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { background-color: #0a0f1c; color: #cbd5e1; font-family: 'Inter', sans-serif; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 0 18px rgba(0,255,255,0.05); border-radius: 1rem; transition: all 0.3s ease; }
    .card:hover { box-shadow: 0 0 28px rgba(0,255,255,0.15); transform: translateY(-2px); }
    .glow { text-shadow: 0 0 12px rgba(0,255,255,0.4); color: #67e8f9; }
    .muted { color: #94a3b8; }
    .btn-primary { background: linear-gradient(90deg,#0ea5e9,#06b6d4); color:white; font-weight:600; border-radius:0.5rem; padding:0.6rem 1rem; transition: all 0.2s ease; }
    .btn-primary:hover { opacity:0.9; box-shadow:0 0 14px rgba(6,182,212,0.5); }
    .btn-secondary { border:1px solid rgba(255,255,255,0.1); color:#cbd5e1; border-radius:0.5rem; padding:0.6rem 1rem; }
  </style>
</head>

<body class="antialiased">
  <div class="max-w-7xl mx-auto p-6 space-y-6">
    <header class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-semibold glow">Nexus System — Demo</h1>
        <p class="muted text-sm">AI Debug Assistant • Live demo</p>
      </div>
      <div class="flex space-x-3">
        <button id="btn-create" class="btn-primary">Create Sample Event</button>
        <button id="btn-refresh" class="btn-secondary">Refresh</button>
      </div>
    </header>

    <!-- Metrics cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="card p-4">
        <div class="text-sm muted">Uptime</div>
        <div class="text-3xl font-bold text-emerald-400" id="uptime">—</div>
        <div class="text-sm muted mt-2">Active Alerts: <span id="alerts-count" class="text-amber-400">—</span></div>
      </div>
      <div class="card p-4">
        <div class="text-sm muted">Avg API Latency</div>
        <div class="text-3xl font-bold text-sky-400" id="latency">— ms</div>
        <canvas id="chart-cpu" height="100" class="mt-2"></canvas>
      </div>
      <div class="card p-4">
        <div class="text-sm muted">Error Rate</div>
        <div class="text-3xl font-bold text-rose-400" id="error-rate">—%</div>
        <canvas id="chart-mem" height="100" class="mt-2"></canvas>
      </div>
    </div>

    <!-- Charts and Events -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
      <div class="lg:col-span-2 space-y-4">
        <div class="card p-4">
          <h2 class="text-lg font-semibold">API Performance Trends</h2>
          <p class="muted text-sm">Live CPU & Memory samples</p>
          <canvas id="chart-trend" height="120" class="mt-3"></canvas>
        </div>

        <div class="card p-4">
          <h2 class="text-lg font-semibold">Events Table</h2>
          <table class="w-full text-sm mt-3">
            <thead class="text-left muted text-xs border-b border-slate-700">
              <tr><th>ID</th><th>Type</th><th>Message</th><th>Time</th></tr>
            </thead>
            <tbody id="events-table" class="divide-y divide-slate-800"></tbody>
          </table>
        </div>
      </div>

      <!-- Right column -->
      <aside class="space-y-4">
        <div class="card p-4">
          <h3 class="text-lg font-semibold">AI Insights</h3>
          <div id="ai-suggestions" class="mt-3 space-y-3 text-sm"></div>
        </div>

        <div class="card p-4">
          <h3 class="text-lg font-semibold">Ask AI (quick)</h3>
          <textarea id="ai-input" rows="3" class="w-full bg-slate-900 rounded p-2 text-sm mt-2" placeholder="Type event id or question..."></textarea>
          <div class="mt-2 flex space-x-2">
            <button id="btn-ask" class="btn-primary flex-1">Ask AI</button>
            <button id="btn-clear" class="btn-secondary flex-1">Clear</button>
          </div>
          <div id="ai-response" class="mt-3 text-sm muted"></div>
        </div>
      </aside>
    </div>

    <footer class="text-center muted text-xs mt-8">© Nexus System — Demo build for investors • Powered by Flask + OpenAI</footer>
  </div>

  <script>
    let trendChart, cpuChart, memChart;
    function initCharts() {
      const ctxTrend = document.getElementById("chart-trend").getContext("2d");
      trendChart = new Chart(ctxTrend, {
        type: "line",
        data: { labels: [], datasets: [{ label: "CPU %", data: [], borderColor: "#06b6d4", tension: 0.4, fill: true }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });

      cpuChart = new Chart(document.getElementById("chart-cpu"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Latency", data: [], backgroundColor: "#0ea5e9" }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });

      memChart = new Chart(document.getElementById("chart-mem"), {
        type: "bar",
        data: { labels: [], datasets: [{ label: "Errors", data: [], backgroundColor: "#f43f5e" }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });
    }

    async function jfetch(url, opts) {
      try { const r = await fetch(url, opts); return await r.json(); }
      catch (e) { console.warn("fetch failed", e); return null; }
    }

    async function refreshMetrics() {
      const m = await jfetch("/api/metrics");
      if (!m || !m.ok) return;
      document.getElementById("uptime").innerText = Math.round(99 + Math.random()*0.9) + "%";
      document.getElementById("latency").innerText = Math.round(100+Math.random()*200) + " ms";
      document.getElementById("error-rate").innerText = Math.round(Math.random()*5) + "%";
      document.getElementById("alerts-count").innerText = Math.floor(Math.random()*8);

      const labels = m.series.labels.map(t=> new Date(t*1000).toLocaleTimeString());
      const cpu = m.series.cpu;
      const mem = m.series.mem;
      trendChart.data.labels = labels; trendChart.data.datasets[0].data = cpu; trendChart.update();
      cpuChart.data.labels = labels; cpuChart.data.datasets[0].data = cpu.map(v=>v/2); cpuChart.update();
      memChart.data.labels = labels; memChart.data.datasets[0].data = mem.map(v=>v/3); memChart.update();

      const tbl = document.getElementById("events-table");
      tbl.innerHTML = "";
      ["ev_demo_1","ev_demo_2","ev_demo_3","ev_demo_4","ev_demo_5"].forEach((id,i)=>{
        tbl.innerHTML += `<tr><td>${id}</td><td>${["ERROR","WARN","INFO"][i%3]}</td><td class="muted">Demo message ${i+1}</td><td>now</td></tr>`;
      });
    }

    async function refreshAISuggestions() {
      const r = await jfetch("/api/ai/suggestions");
      const box = document.getElementById("ai-suggestions");
      box.innerHTML = "";
      if (!r || !r.ok || !r.suggestions.length) {
        box.innerHTML = `<div class='muted'>No suggestions yet. Create an event.</div>`;
        return;
      }
      r.suggestions.forEach(s=>{
        box.innerHTML += `<div class='border border-slate-700 rounded p-2'>
          <div class='font-semibold text-cyan-400'>${s.title}</div>
          <div class='muted text-xs mt-1'>${s.body}</div>
        </div>`;
      });
    }

    async function setupUI(){
      document.getElementById("btn-create").onclick = async()=>{
        await jfetch("/api/ingest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:"ERROR",message:"Manual test event"})});
        await refreshAISuggestions(); await refreshMetrics();
      };
      document.getElementById("btn-refresh").onclick = async()=>{await refreshMetrics(); await refreshAISuggestions();};
      document.getElementById("btn-ask").onclick = async()=>{
        const val=document.getElementById("ai-input").value||"ev_demo_1";
        const res=await jfetch("/api/ai/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:val})});
        const out=document.getElementById("ai-response");
        if(res&&res.ok){out.innerHTML=`<span class='text-cyan-400 font-semibold'>[${res.provider}]</span> ${res.suggestion}`; await refreshAISuggestions();}
        else out.innerText="AI unavailable";
      };
      document.getElementById("btn-clear").onclick=()=>{document.getElementById("ai-input").value="";document.getElementById("ai-response").innerText="";};
    }

    (function(){
      initCharts(); setupUI(); refreshMetrics(); refreshAISuggestions();
      setInterval(()=>{refreshMetrics(); refreshAISuggestions();},10000);
    })();
  </script>
</body>
</html>
